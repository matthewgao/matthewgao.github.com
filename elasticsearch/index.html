<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="elasticsearch," />





  <link rel="alternate" href="/atom.xml" title="Matthew Note" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="搞一搞ELK">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch Note">
<meta property="og:url" content="http://gaoshen.site/elasticsearch/index.html">
<meta property="og:site_name" content="Matthew Note">
<meta property="og:description" content="搞一搞ELK">
<meta property="og:updated_time" content="2016-07-28T06:10:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ElasticSearch Note">
<meta name="twitter:description" content="搞一搞ELK">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://gaoshen.site/elasticsearch/"/>





  <title> ElasticSearch Note | Matthew Note </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0d7319169ed36fc7c6c76a85b1353472";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Matthew Note</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://gaoshen.site/elasticsearch/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Matthew Gao">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Matthew Note">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Matthew Note" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                ElasticSearch Note
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/elasticsearch/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="elasticsearch/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          
              <div class="post-description">
                  搞一搞ELK
              </div>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><hr>
<h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h2><h3 id="index-indices"><a href="#index-indices" class="headerlink" title="index/indices"></a>index/indices</h3><p>index包含多个type</p>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>type包含多个documents</p>
<h3 id="documents"><a href="#documents" class="headerlink" title="documents"></a>documents</h3><p>每一条记录是一个documents</p>
<h2 id="Restriction"><a href="#Restriction" class="headerlink" title="Restriction"></a>Restriction</h2><ul>
<li>对于SQL类似的Join命令，ES并不擅长，会消耗大量的计算cycle，间接上只支持子查询</li>
</ul>
<h3 id="Index-Limitation"><a href="#Index-Limitation" class="headerlink" title="Index Limitation"></a>Index Limitation</h3><p>Each Elasticsearch shard is a Lucene index. There is a maximum number of documents you can have in a single Lucene index. As of <a href="https://issues.apache.org/jira/browse/LUCENE-5843" target="_blank" rel="external">LUCENE-5843</a>, the limit is 2,147,483,519 (= Integer.MAX_VALUE - 128) documents. You can monitor shard sizes using the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-shards.html" target="_blank" rel="external">_cat/shards</a> api.</p>
<h2 id="Analyzed-String"><a href="#Analyzed-String" class="headerlink" title="Analyzed String"></a>Analyzed String</h2><p>默认所有string进来都是analyzed，这意味着可能会被分词，所以要在插入数据之前用MAPPing的API设置好<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html" target="_blank" rel="external">MAPPing API</a></p>
<h2 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h2><p>支持lucence的语法<a href="https://lucene.apache.org/core/2_9_4/queryparsersyntax.html" target="_blank" rel="external">Lucence语法</a>和JSON的DSL语法</p>
<ul>
<li>Lucence<br>Enter a query string in the Search field:<ol>
<li>To perform a free text search, simply enter a text string. For example, if you’re searching web server logs, you could enter safari to search all fields for the term safari.</li>
<li>To search for a value in a specific field, you prefix the value with the name of the field. For example, you could enter status:200 to limit the results to entries that contain the value 200 in the status field.</li>
<li>To search for a range of values, you can use the bracketed range syntax, <code>[START_VALUE TO END_VALUE]</code>. For example, to find entries that have 4xx status codes, you could enter status:[400 TO 499].</li>
<li>To specify more complex search criteria, you can use the Boolean operators AND, OR, and NOT. For example, to find entries that have 4xx status codes and have an extension of php or html, you could enter status:[400 TO 499] AND (extension:php OR extension:html).</li>
</ol>
</li>
<li>支持夸index查詢</li>
<li>Automatic index creation can be disabled by setting <code>action.auto_create_index</code> to false in the config file of all nodes. Automatic mapping creation can be disabled by setting index.mapper.dynamic to false in the config files of all nodes (or on the specific index settings).</li>
<li>The index operation can be executed without specifying the id. In such a case, an id will be generated automatically. In addition, the op_type will automatically be set to <code>create</code>. Here is an example (note the POST used instead of PUT)</li>
<li>A child document can be indexed by specifying its parent when indexing. When indexing a child document, the routing value is automatically set to be the same as its parent, unless the routing value is explicitly specified using the routing parameter. 需要設置mapping，dynamic mapping不能自动配置parant/child</li>
<li>If you only need one or two fields from the complete <code>_source</code>, you can use the <code>_source_include</code> &amp; <code>_source_exclude</code> parameters to include or filter out that parts you need. This can be especially helpful with large documents where partial retrieval can save on network overhead. Both parameters take a comma separated list of fields or wildcard expressions. Example:</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">curl</span> -XGET <span class="string">'http://localhost:9200/twitter/tweet/1?_source_include=*.id&amp;_source_exclude=entities'</span></div><div class="line"><span class="comment"># shorter notation</span></div><div class="line">curl -XGET <span class="string">'http://localhost:9200/twitter/tweet/1?_source=*.id,retweeted'</span></div></pre></td></tr></table></figure>
<ul>
<li>inner_hit用来处理nested/child/parent search, 不然他会返回最上级的结果，而不是你期待的，似乎ES本身不支持nested，nested也是会被flatten</li>
<li>global aggregation, 可以控制aggs不受query结果影响， 与此类似reverse_nested 可以取回他的父结构的element</li>
<li>significant Terms???</li>
<li><strong>pipeline aggregation</strong>, 还在试验阶段，这个<strong>牛逼</strong>啊</li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/complex-core-fields.html#inner-objects" target="_blank" rel="external">Complex Core Field Types</a></li>
</ul>
<h3 id="filter-path"><a href="#filter-path" class="headerlink" title="filter_path"></a>filter_path</h3><p>URI可以指定一个filter_path参数来表示返回那些值，例如：</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/_nodes/stats?filter_path=nodes.*.ho*'</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"nodes"</span> : &#123;</div><div class="line">    <span class="string">"lvJHed8uQQu4brS-SXKsNA"</span> : &#123;</div><div class="line">      <span class="string">"host"</span> : <span class="string">"portable"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Bucket-Aggregations"><a href="#Bucket-Aggregations" class="headerlink" title="Bucket Aggregations"></a>Bucket Aggregations</h3><p>Aggregation的结果用于后续bucket或者metric aggregation使用，它只是取得子集<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket.html" target="_blank" rel="external">Bucket Aggregations</a><br>Buckets are analogous to SQL GROUP BY statements</p>
<h3 id="Metric-Aggregations"><a href="#Metric-Aggregations" class="headerlink" title="Metric Aggregations"></a>Metric Aggregations</h3><p>Aggregation成可度量的数字<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics.html" target="_blank" rel="external">Metric Aggregations</a></p>
<h3 id="Scripted-fields"><a href="#Scripted-fields" class="headerlink" title="Scripted fields"></a>Scripted fields</h3><p>Scripted fields use the Lucene expression syntax. For more information, see <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html#_lucene_expressions_scripts" target="_blank" rel="external">Lucene Expressions</a> Scripts.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><ul>
<li>nested 数据结构，导致insert的资源耗费上升大概50%，因为ES对于update采用的是DELETE-&gt;INSERT的方法，所以额外开销在这里，另外查询也会耗费一定时间，用indexID检索可以忽略这部分</li>
<li>正常的syslog like结构，插入数据高效，但是结构并不是特别清晰</li>
<li>官方文档上说Child/Parant方式查询效率远比nested低<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/parent-child-performance.html" target="_blank" rel="external">Practical Considerations</a>, 如果index时间要求比search要求高，那么可以考虑用parant/child模式</li>
<li>Append<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/partial-updates.html" target="_blank" rel="external">Partial Updates to Documents</a>数据只能使用script方式，默认是关闭的，因为他有注入的风险，所以谨慎使用<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html" target="_blank" rel="external">Scripting</a></li>
<li><code>include_in_parent</code> 可以把nested的数据，以flat的格式加到他的父节点上，但是这个功能似乎已经deprecate了，开了这个速度有所下降，因为他会反过来搜索parent的element</li>
<li>设计一个以时间为主线的Log分析系统的时候建议使用<code>index_name+time</code>作为index名字，这样更加方便管理和做shard</li>
</ul>
<h1 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h1><hr>
<ul>
<li>filter is global??</li>
<li>Include/Exclude Pattern</li>
<li>Include/Exclude Pattern Flags</li>
<li>JSON input</li>
<li>Discover的query不能是一个最终统计值，只是检索数据</li>
<li>Sense 是个好插件，省了用Curl了</li>
</ul>
<h2 id="Restriction-1"><a href="#Restriction-1" class="headerlink" title="Restriction"></a>Restriction</h2><ul>
<li>暂时不支持nested、parant/child的可视化，但是已经有人在做了，不久的将来应该会有</li>
<li>table不支持导出</li>
<li>Discover展开数据也不够友好</li>
</ul>
<h1 id="Requirement-amp-Desgin"><a href="#Requirement-amp-Desgin" class="headerlink" title="Requirement &amp; Desgin"></a>Requirement &amp; Desgin</h1><hr>
<h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2><p>实际上Runtime数据不应该是一个log analyzer应该处理的事情，但是我们依旧暂时假定支持这样做</p>
<ul>
<li>Active user: 检查session template是否有endtime</li>
<li>Active user’s Realm/Zone/Community/IP</li>
</ul>
<h2 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h2><ul>
<li>TopN Resource的inbound/outbound总和</li>
<li>TopN User的inbound/outbound总和</li>
<li>总的Realm/Zone/Community个数</li>
<li>最常访问资源TopN</li>
<li>inbound/outbound流量TopN资源</li>
<li>AccessAgent总个数</li>
<li>Platform总个数</li>
<li>地理位置范围</li>
<li>TopN failure profile</li>
</ul>
<p>以上都可以做细致区分，比如Active User的如上结果，Web Access的如上结果，Tunnel的如上结果，已经断开连接用户的如上结果</p>
<blockquote>
<p>是否是web用户可以通过是否有IP来确定，但是有误差</p>
</blockquote>
<h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><p>基本包含两个数据类型：</p>
<ul>
<li>SessionInfo: 包含Username, Realm, Community, ClientIP, assigned IP, starttime, endtime, failure profile, Zone, Platform, AccessAgent, 所有这些信息可以通过partial update, 来在后期插入，资源开销基本可控, sessionInfo都以<code>teamID</code>作为<code>_id</code></li>
<li>AccessInfo: 包含teamID, destination, port, protocol, inbound, outbound, 以及所有SessionInfo的数据（可以尝试通过parent/child方式实现), 实际上我们只需要复制一些基础的信息，比如teamID，username，两个IP，accessAgent， 对于其他的item和access resource没有直接关系，也不大可能去分析他们之间的关系，为了这个可能需要KernelSession发送一个teamID（12bytes）出来</li>
<li>CurrentUser: 一个单一的数据，只通过partial update更新</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Type</th>
<th style="text-align:center">Public</th>
<th style="text-align:center">Internal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Modules</td>
<td style="text-align:center">lower_with_under</td>
<td style="text-align:center">_lower_with_under</td>
</tr>
</tbody>
</table>
<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><hr>
<ul>
<li>定义timestamp</li>
<li>检索所有不重复的teamId列表(nested query)</li>
<li>scripted update可以自加 自減，对于concurrent user可能有用<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-update.html" target="_blank" rel="external">Update Doc</a>, access 记录都加到同一个document下面（会不会有性能问题），kibana支持nested aggregation</li>
<li>Upsert 可以处理存在更新， 不存在创建的问题</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/elasticsearch/" rel="tag"># elasticsearch</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/xslt/" rel="next" title="XSLT and XPATH">
                <i class="fa fa-chevron-left"></i> XSLT and XPATH
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014-9-2-shell-note/" rel="prev" title="SHELL Command/Script Notes">
                SHELL Command/Script Notes <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="elasticsearch/"
           data-title="ElasticSearch Note" data-url="http://gaoshen.site/elasticsearch/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Matthew Gao" />
          <p class="site-author-name" itemprop="name">Matthew Gao</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/matthewgao" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/xxiaogao" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/334332999" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/gaoshen" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ElasticSearch"><span class="nav-number">1.</span> <span class="nav-text">ElasticSearch</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Concept"><span class="nav-number">1.1.</span> <span class="nav-text">Concept</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#index-indices"><span class="nav-number">1.1.1.</span> <span class="nav-text">index/indices</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#type"><span class="nav-number">1.1.2.</span> <span class="nav-text">type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#documents"><span class="nav-number">1.1.3.</span> <span class="nav-text">documents</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Restriction"><span class="nav-number">1.2.</span> <span class="nav-text">Restriction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-Limitation"><span class="nav-number">1.2.1.</span> <span class="nav-text">Index Limitation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Analyzed-String"><span class="nav-number">1.3.</span> <span class="nav-text">Analyzed String</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Search"><span class="nav-number">1.4.</span> <span class="nav-text">Search</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#filter-path"><span class="nav-number">1.4.1.</span> <span class="nav-text">filter_path</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bucket-Aggregations"><span class="nav-number">1.4.2.</span> <span class="nav-text">Bucket Aggregations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Metric-Aggregations"><span class="nav-number">1.4.3.</span> <span class="nav-text">Metric Aggregations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scripted-fields"><span class="nav-number">1.4.4.</span> <span class="nav-text">Scripted fields</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">1.5.</span> <span class="nav-text">Conclusion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Kibana"><span class="nav-number">2.</span> <span class="nav-text">Kibana</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Restriction-1"><span class="nav-number">2.1.</span> <span class="nav-text">Restriction</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Requirement-amp-Desgin"><span class="nav-number">3.</span> <span class="nav-text">Requirement & Desgin</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Runtime"><span class="nav-number">3.1.</span> <span class="nav-text">Runtime</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Statistics"><span class="nav-number">3.2.</span> <span class="nav-text">Statistics</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Design"><span class="nav-number">3.3.</span> <span class="nav-text">Design</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TODO"><span class="nav-number">4.</span> <span class="nav-text">TODO</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Matthew Gao</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="http://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="http://cdn.bootcss.com/fastclick/1.0.5/fastclick.min.js"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"matthewgao"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  








  
  

  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
